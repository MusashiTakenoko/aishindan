<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çµŒå–¶å±¤å‘ã‘AIæ´»ç”¨ç†è§£åº¦è¨ºæ–­ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼‰</title>
  <style>
    :root{
      --bg1:#f7f7ff;
      --bg2:#eef9ff;
      --card:#ffffff;
      --text:#1f2340;
      --muted:#5b5f80;
      --line:rgba(31,35,64,.10);
      --p1:#b69cff;
      --p2:#7bd7ff;
      --danger:#ff6b8b;
      --shadow: 0 14px 34px rgba(31,35,64,.10);
      --shadow2: 0 10px 24px rgba(31,35,64,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 10% 0%, rgba(182,156,255,.35), transparent 55%),
        radial-gradient(900px 700px at 95% 15%, rgba(123,215,255,.30), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:22px 16px 56px}
    header{display:flex;align-items:flex-end;justify-content:space-between;gap:14px;flex-wrap:wrap;padding:6px 0 8px}
    .brand{display:flex;flex-direction:column;gap:6px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:7px 12px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.75);box-shadow:var(--shadow2);color:var(--muted);font-size:12px;width:fit-content}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .subtitle{margin:0;color:var(--muted);font-size:13px}

    .btn{appearance:none;border:1px solid var(--line);background:rgba(255,255,255,.82);color:var(--text);padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:800;font-size:14px;box-shadow:var(--shadow2);transition:transform .06s ease, box-shadow .2s ease, background .2s ease}
    .btn:hover{background:#fff;box-shadow:0 14px 28px rgba(31,35,64,.10)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:rgba(182,156,255,.55);background:linear-gradient(135deg, rgba(182,156,255,.65), rgba(123,215,255,.55));color:#1a1d34}
    .btn.ghost{background:rgba(255,255,255,.62)}
    .btn.danger{border-color:rgba(255,107,139,.45);color:#5a1630;background:rgba(255,255,255,.82)}

    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
    .top-actions{display:flex;gap:10px;flex-wrap:wrap}
    .section-title{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .section-title h2{margin:0;font-size:16px}
    .hint{color:var(--muted);font-size:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:7px 12px;border-radius:999px;border:1px solid var(--line);background:rgba(182,156,255,.14);font-size:12px;color:#3a2f72;white-space:nowrap}
    .spark{display:inline-block;transform:translateY(-1px)}

    .progressRow{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .progress{height:10px;border-radius:999px;background:rgba(182,156,255,.16);border:1px solid var(--line);overflow:hidden;width:min(560px, 100%)}
    .progress>div{height:100%;width:0%;background:linear-gradient(90deg, rgba(182,156,255,.95), rgba(123,215,255,.92));transition:width .25s ease;border-radius:999px}

    .qwrap{display:grid;gap:12px}
    .qcard{border:1px solid var(--line);background:linear-gradient(180deg, rgba(182,156,255,.10), rgba(123,215,255,.08));border-radius:18px;padding:14px;min-height:110px}
    .qhead{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .qno{font-weight:950;font-size:12px;color:#3a2f72;letter-spacing:.2px;display:inline-flex;gap:8px;align-items:center}
    .qno .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg, rgba(182,156,255,.95), rgba(123,215,255,.95));box-shadow:0 6px 14px rgba(182,156,255,.35)}
    .qtext{margin:8px 0 0;font-weight:900;font-size:15px}
    .axis{color:var(--muted);font-size:12px;white-space:nowrap;background:rgba(255,255,255,.75);border:1px solid var(--line);padding:6px 10px;border-radius:999px}

    .opts{display:grid;gap:8px;margin-top:12px}
    .opt{display:flex;gap:10px;align-items:flex-start;padding:12px 12px;border-radius:16px;border:1px solid rgba(31,35,64,.12);background:rgba(255,255,255,.88);cursor:pointer;transition:transform .06s ease, box-shadow .2s ease, background .2s ease}
    .opt:hover{background:#fff;box-shadow:0 12px 20px rgba(31,35,64,.08)}
    .opt:active{transform:translateY(1px)}
    .opt input{margin-top:2px}
    .opt .otext{font-size:13px;color:var(--text)}

    .navRow{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .note{color:var(--muted);font-size:12px}

    .toast{display:none;margin-top:10px;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,107,139,.35);background:rgba(255,107,139,.10);color:#7b1232;font-size:13px}

    .complete{display:none;border:1px dashed rgba(182,156,255,.55);background:linear-gradient(135deg, rgba(182,156,255,.14), rgba(123,215,255,.12));border-radius:18px;padding:14px}
    .complete .title{font-weight:950;font-size:15px}
    .complete .desc{color:var(--muted);font-size:13px;margin-top:6px}

    dialog{border:none;border-radius:20px;padding:0;width:min(760px, calc(100% - 22px));background:#fff;box-shadow:0 30px 90px rgba(31,35,64,.18)}
    dialog::backdrop{background:rgba(31,35,64,.45)}
    .modal{padding:16px;border-radius:20px}
    .modal header{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;padding:0 0 8px}
    .modal h3{margin:0;font-size:16px}
    .modal .sub{margin:6px 0 0;color:var(--muted);font-size:12px}
    .modal .content{display:grid;gap:12px;margin-top:12px}
    .fields{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:640px){.fields{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--muted)}
    .field input{padding:11px 12px;border-radius:14px;border:1px solid rgba(31,35,64,.16);background:rgba(123,215,255,.08);color:var(--text);outline:none}
    .field input:focus{border-color:rgba(182,156,255,.65);background:rgba(182,156,255,.10)}

    .result{display:none}
    .resultTop{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .rtype{font-size:20px;font-weight:1000}
    .rmeta{display:flex;gap:8px;flex-wrap:wrap}
    .tag{display:inline-flex;align-items:center;gap:8px;padding:7px 12px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.9);color:var(--muted);font-size:12px}
    .tag.pop{background:linear-gradient(135deg, rgba(182,156,255,.30), rgba(123,215,255,.26));color:#2a2d52;font-weight:900}
    .oneLine{margin-top:6px;color:var(--muted);font-size:13px}

    .resultGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
    @media(max-width:820px){.resultGrid{grid-template-columns:1fr}}

    .panel{border:1px solid var(--line);border-radius:18px;padding:14px;background:rgba(255,255,255,.92)}
    .panel h4{margin:0 0 6px;font-size:14px}
    .panel p{margin:0;color:var(--muted);font-size:13px;white-space:pre-line}

    .scorePanel{border:1px solid var(--line);border-radius:18px;padding:14px;background:linear-gradient(180deg, rgba(123,215,255,.12), rgba(182,156,255,.10))}
    .scorePanel h4{margin:0 0 10px;font-size:14px}
    .bars{display:grid;gap:10px}
    .bar{display:grid;grid-template-columns:160px 1fr 58px;gap:10px;align-items:center}
    @media(max-width:640px){.bar{grid-template-columns:1fr}}
    .bar .name{color:#2a2d52;font-size:12px;font-weight:900}
    .meter{height:10px;border-radius:999px;background:rgba(255,255,255,.75);border:1px solid rgba(31,35,64,.10);overflow:hidden}
    .meter>div{height:100%;width:0%;background:linear-gradient(90deg, rgba(182,156,255,.95), rgba(123,215,255,.92));transition:width .25s ease}
    .bar .score{font-variant-numeric:tabular-nums;color:var(--muted);font-size:12px;text-align:right}

    .insight{margin-top:12px;display:grid;gap:10px}
    .insight .line{display:flex;gap:10px;align-items:flex-start;border:1px solid var(--line);background:rgba(255,255,255,.92);border-radius:16px;padding:12px}
    .emoji{font-size:18px;line-height:1}
    .line b{display:block;margin-bottom:2px}
    .line span{color:var(--muted);font-size:13px}

    .cta{margin-top:14px;border:1px solid rgba(182,156,255,.45);background:linear-gradient(135deg, rgba(182,156,255,.18), rgba(123,215,255,.16));border-radius:18px;padding:14px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .cta .title{font-weight:1000}
    .cta .desc{color:var(--muted);font-size:13px;margin-top:4px}

    footer{margin-top:18px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge">çµŒå–¶å±¤å‘ã‘</div>
        <h1>çµŒå–¶å±¤å‘ã‘ AIæ´»ç”¨ç†è§£åº¦è¨ºæ–­</h1>
        <p class="subtitle">16å•ãƒ»4ã€œ5åˆ†ã§ã€Œã„ã¾æ•´ãˆã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆã€ã‚’ã‚„ã•ã—ãè¦‹ãˆã‚‹åŒ–ã—ã¾ã™ã€‚</p>
      </div>
      <div class="top-actions">
        <button class="btn danger" id="btnReset" type="button">ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn ghost" id="btnJumpResult" type="button" disabled title="å®Œäº†å¾Œã«è¡¨ç¤ºã•ã‚Œã¾ã™">è¨ºæ–­çµæœã‚’è¦‹ã‚‹</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="section-title">
          <h2>é€²æ— <span class="spark">âœ¨</span></h2>
          <span class="hint" id="progressText">â€”</span>
        </div>
        <div class="progressRow">
          <div class="progress"><div id="progressBar"></div></div>
          <span class="pill" id="axisPill">â€”</span>
        </div>
        <div class="note" style="margin-top:10px">å›ç­”å½¢å¼ï¼šA=3 / B=2 / C=1 / D=0ï¼ˆçµæœè©³ç´°ã¯å…¥åŠ›å¾Œã«è¡¨ç¤ºï¼‰</div>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>è³ªå•</h2>
          <span class="hint">1å•ãšã¤å›ç­”ã—ã¦ãã ã•ã„</span>
        </div>

        <div class="qwrap">
          <div class="qcard" id="questionCard"></div>

          <div class="navRow">
            <button class="btn" id="btnPrev" type="button">â† å‰ã¸</button>
            <div class="note" id="navHint">é¸æŠã—ã¦ã€Œæ¬¡ã¸ã€</div>
            <button class="btn primary" id="btnNext" type="button">æ¬¡ã¸ â†’</button>
          </div>

          <div class="toast" id="toast"></div>

          <div class="complete" id="completeBox">
            <div class="title">ğŸ‰ è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸï¼</div>
            <div class="desc">ã€Œè¨ºæ–­çµæœã‚’è¦‹ã‚‹ã€ã‹ã‚‰ã€çµæœè©³ç´°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</div>
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn primary" id="btnToResult" type="button">è¨ºæ–­çµæœã‚’è¦‹ã‚‹</button>
              <button class="btn" id="btnReview" type="button">å›ç­”ã‚’è¦‹ç›´ã™</button>
            </div>
          </div>
        </div>
      </section>

      <section class="card result" id="resultCard">
        <div class="section-title">
          <h2>è¨ºæ–­çµæœ</h2>
          <span class="hint" id="resultMeta">â€”</span>
        </div>

        <div class="resultTop">
          <div>
            <div class="rtype" id="resultType">â€”</div>
            <div class="oneLine" id="resultOneLine">â€”</div>
          </div>
          <div class="rmeta">
            <span class="tag pop" id="resultLevel">Lvâ€”</span>
            <span class="tag" id="resultTotal">Total â€”/48</span>
          </div>
        </div>

        <div class="resultGrid">
          <div class="scorePanel">
            <h4>ã‚¹ã‚³ã‚¢ï¼ˆ4è»¸ï¼‰</h4>
            <div class="bars">
              <div class="bar"><div class="name">AIæˆ¦ç•¥æˆç†Ÿåº¦ï¼ˆSï¼‰</div><div class="meter"><div id="barS"></div></div><div class="score" id="scoreS">â€”/12</div></div>
              <div class="bar"><div class="name">çµ„ç¹”å®Ÿè¡ŒåŠ›ï¼ˆOï¼‰</div><div class="meter"><div id="barO"></div></div><div class="score" id="scoreO">â€”/12</div></div>
              <div class="bar"><div class="name">æŠ•è³‡åˆ¤æ–­åŠ›ï¼ˆIï¼‰</div><div class="meter"><div id="barI"></div></div><div class="score" id="scoreI">â€”/12</div></div>
              <div class="bar"><div class="name">ç«¶åˆèªè­˜åº¦ï¼ˆMï¼‰</div><div class="meter"><div id="barM"></div></div><div class="score" id="scoreM">â€”/12</div></div>
            </div>

            <div class="insight">
              <div class="line"><div class="emoji">ğŸ§­</div><div><b>ã„ã¾æ•´ãˆã‚‹ã¨ä¼¸ã³ã‚„ã™ã„é ˜åŸŸ</b><span id="insightWeak">â€”</span></div></div>
              <div class="line"><div class="emoji">ğŸŒŸ</div><div><b>å¼·ã¿ã¨ã—ã¦æ´»ã‹ã—ã‚„ã™ã„é ˜åŸŸ</b><span id="insightStrong">â€”</span></div></div>
            </div>
          </div>

          <div class="panel"><h4>ã‚ãªãŸã®ä¼šç¤¾ã®ç¾åœ¨åœ°</h4><p id="txtNow">â€”</p></div>
          <div class="panel"><h4>ã“ã®ã¾ã¾é€²ã‚“ã å ´åˆã«èµ·ã“ã‚Šã‚„ã™ã„ã“ã¨</h4><p id="txtRisk">â€”</p></div>
          <div class="panel"><h4>æ¬¡ã«æ•´ç†ã™ã¹ããƒã‚¤ãƒ³ãƒˆï¼ˆä¾‹ï¼‰</h4><p id="txtNext">â€”</p></div>
        </div>

        <div class="cta">
          <div>
            <div class="title" id="ctaTitle">â€”</div>
            <div class="desc" id="ctaDesc">â€”</div>
          </div>
          <button class="btn primary" type="button" id="btnCta">å€‹åˆ¥ç›¸è«‡ä¼šï¼ˆç„¡æ–™ï¼‰ã‚’ç”³ã—è¾¼ã‚€</button>
        </div>

        <div class="note" style="margin-top:10px">â€»ã“ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã¯ç”³è¾¼ã¿ãƒœã‚¿ãƒ³ã¯ãƒ€ãƒŸãƒ¼ã§ã™ã€‚</div>
      </section>

      <footer>
        <div>Â©FCE AIã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³äº‹æ¥­æœ¬éƒ¨</b></div>
      </footer>
    </div>
  </div>

  <dialog id="leadModal">
    <div class="modal">
      <header>
        <div>
          <h3>çµæœã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h3>
          <div class="sub">â€»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ã€‚å…¥åŠ›æƒ…å ±ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆä¿å­˜ä¸å¯ç’°å¢ƒã§ã¯ãƒ¡ãƒ¢ãƒªä¿å­˜ï¼‰ã€‚</div>
        </div>
        <button class="btn" type="button" id="btnCloseModal">é–‰ã˜ã‚‹</button>
      </header>
      <div class="content">
        <div class="fields">
          <div class="field"><label for="name">æ°åï¼ˆå¿…é ˆï¼‰</label><input id="name" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" autocomplete="name" /></div>
          <div class="field"><label for="company">ä¼šç¤¾åï¼ˆå¿…é ˆï¼‰</label><input id="company" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾ã€‡ã€‡" autocomplete="organization" /></div>
          <div class="field"><label for="role">å½¹è·ï¼ˆå¿…é ˆï¼‰</label><input id="role" placeholder="ä¾‹ï¼šä»£è¡¨å–ç· å½¹ / å–ç· å½¹ / éƒ¨é•·" autocomplete="organization-title" /></div>
          <div class="field"><label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå¿…é ˆï¼‰</label><input id="email" placeholder="ä¾‹ï¼šname@company.co.jp" autocomplete="email" /></div>
        </div>
        <div class="navRow">
          <div class="note">å…¥åŠ›å¾Œã€çµæœè©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
          <button class="btn primary" type="button" id="btnSubmitLead">å…¥åŠ›ã—ã¦çµæœã‚’è¦‹ã‚‹</button>
        </div>
        <div class="toast" id="leadToast"></div>
      </div>
    </div>
  </dialog>

<script>
    // Storage wrapper
    const mem = {};
    function lsGet(key){ try{ return localStorage.getItem(key); }catch(e){ return (key in mem) ? mem[key] : null; } }
    function lsSet(key,val){ try{ localStorage.setItem(key,val); }catch(e){ mem[key] = String(val); } }
    function lsRemove(key){ try{ localStorage.removeItem(key); }catch(e){ delete mem[key]; } }

    const QUESTIONS = [
      { id:'q1', axis:'S', title:'è²´ç¤¾ã®AIæ´»ç”¨ã«ã¤ã„ã¦ã€æœ€ã‚‚è¿‘ã„çŠ¶æ³ã¯?', options:['çµŒå–¶æˆ¦ç•¥ã«æ˜è¨˜ã•ã‚Œã€AIã«é–¢ã™ã‚‹KPI/é‡ç‚¹ãƒ†ãƒ¼ãƒãŒã‚ã‚‹','é‡è¦æ€§ã¯èªè­˜ã—ã¦ã„ã‚‹ãŒã€å…·ä½“è¨ˆç”»ã¯ã“ã‚Œã‹ã‚‰','ä¸€éƒ¨éƒ¨é–€ã§æ¤œè¨ã—ã¦ã„ã‚‹ãŒã€å…¨ç¤¾æ–¹é‡ã§ã¯ãªã„','ã¾ã å…·ä½“çš„ãªæ¤œè¨ã«ã¯è‡³ã£ã¦ã„ãªã„'] },
      { id:'q2', axis:'S', title:'AIå°å…¥ã®ç›®çš„ã¨ã—ã¦æœ€ã‚‚å„ªå…ˆåº¦ãŒé«˜ã„ã‚‚ã®ã¯?', options:['ç«¶äº‰å„ªä½ã«ã¤ãªãŒã‚‹å¤‰é©(æ–°è¦äº‹æ¥­ãƒ»æä¾›ä¾¡å€¤ã®é€²åŒ–)','åç›Šæ€§æ”¹å–„(ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ»æ¥­å‹™åŠ¹ç‡åŒ–)','ç”Ÿç”£æ€§å‘ä¸Š(å€‹äºº/ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã€å“è³ªå‘ä¸Š)','ã¾ã æ˜ç¢ºã«ãªã£ã¦ã„ãªã„'] },
      { id:'q3', axis:'S', title:'AIã§ã€Œã©ã®æ¥­å‹™ã‹ã‚‰ç€æ‰‹ã™ã‚‹ã‹ã€ã®å„ªå…ˆé †ä½ã¯?', options:['å…¨ç¤¾ã§å„ªå…ˆé †ä½ãŒåˆæ„ã•ã‚Œã€ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ãŒã‚ã‚‹','å„ªå…ˆåº¦ã®å€™è£œã¯ã‚ã‚Šã€ã“ã‚Œã‹ã‚‰çµã‚Šè¾¼ã‚€æ®µéš','éƒ¨é–€ã”ã¨ã«ãƒãƒ©ãƒãƒ©ã«æ¤œè¨ã—ã¦ã„ã‚‹','ç‰¹ã«æ±ºã‚ã¦ã„ãªã„'] },
      { id:'q4', axis:'S', title:'AIæ¨é€²ã®ã‚ªãƒ¼ãƒŠãƒ¼(è²¬ä»»ã®æ‰€åœ¨)ã¯?', options:['çµŒå–¶ç›´è½„/å…¨ç¤¾æ¨ªæ–­ã®è²¬ä»»è€…ãŒæ˜ç¢º','ç‰¹å®šéƒ¨é–€ãŒä¸»å°ã—ã¦ã„ã‚‹','æ‹…å½“è€…ãƒ™ãƒ¼ã‚¹ã§æ¤œè¨ä¸­','ã¾ã ä½“åˆ¶ã¯æ•´ã£ã¦ã„ãªã„'] },
      { id:'q5', axis:'O', title:'AIã‚’æ‰±ãˆã‚‹äººæã®ç¢ºä¿æ–¹é‡ã¯?', options:['æ¡ç”¨/è‚²æˆã®è¨ˆç”»ãŒã‚ã‚Šã€é€²è¡Œã—ã¦ã„ã‚‹','æ—¢å­˜äººæã®ãƒªã‚¹ã‚­ãƒªãƒ³ã‚°ã§å¯¾å¿œã™ã‚‹äºˆå®š','åŸºæœ¬ã¯å¤–éƒ¨ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ´»ç”¨ã®æƒ³å®š','äººæç¢ºä¿ã®ç›®å‡¦ã¯ç«‹ã£ã¦ã„ãªã„'] },
      { id:'q6', axis:'O', title:'ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ã®ç¾çŠ¶ã¯?', options:['ãƒ‡ãƒ¼ã‚¿åŸºç›¤ãŒæ•´å‚™ã•ã‚Œã€åˆ†æãƒ»æ´»ç”¨ãŒæ—¥å¸¸çš„','éƒ¨åˆ†çš„ã«ã¯æ´»ç”¨ã—ã¦ã„ã‚‹ãŒã€çµ±åˆã¯å¼±ã„','ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚‹ãŒæ´»ç”¨ã§ãã¦ã„ãªã„','åé›†ãƒ»æ•´å‚™ã‹ã‚‰å¿…è¦'] },
      { id:'q7', axis:'O', title:'æ–°æŠ€è¡“å°å…¥(PoCå«ã‚€)ã®æ„æ€æ±ºå®šã‚¹ãƒ”ãƒ¼ãƒ‰ã¯?', options:['1ãƒ¶æœˆä»¥å†…ã«åˆ¤æ–­ã—ã€ç€æ‰‹ã§ãã‚‹','2ã€œ3ãƒ¶æœˆç¨‹åº¦ã§åˆ¤æ–­ã§ãã‚‹','åŠå¹´ä»¥ä¸Šã‹ã‹ã‚‹ã“ã¨ãŒå¤šã„','åŸºæº–ãŒãªãã€éƒ½åº¦åˆ¤æ–­ã§æ­¢ã¾ã‚Šã‚„ã™ã„'] },
      { id:'q8', axis:'O', title:'ç¾å ´å·»ãè¾¼ã¿ã®è¦‹ç«‹ã¦ã¨ã—ã¦æœ€ã‚‚è¿‘ã„ã®ã¯?', options:['ç¾å ´ã‹ã‚‰ã‚‚æ”¹å–„ææ¡ˆãŒå‡ºã¦ãŠã‚Šã€å·»ãè¾¼ã¿ã¯é€²ã‚ã‚„ã™ã„','ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§æ¨é€²ã™ã‚Œã°å‹•ã','æŠµæŠ—/ä¸å®‰ãŒå¼·ãã€å·¥å¤«ãŒå¿…è¦','ã¾ã ç¾å ´ã«è©±ã›ã¦ã„ãªã„'] },
      { id:'q9', axis:'I', title:'AIæŠ•è³‡ã®åŠ¹æœæ¸¬å®š(ROI)ã®è€ƒãˆæ–¹ã¯?', options:['å®šé‡è©•ä¾¡ã®æ–¹æ³•ãŒã‚ã‚Šã€ç¶™ç¶šè¨ˆæ¸¬ã§ãã‚‹','æ¦‚ç®—ã§è©¦ç®—ã§ãã‚‹','æ–¹æ³•ãŒã‚ˆãåˆ†ã‹ã‚‰ãªã„','ROIã‚ˆã‚Šã¾ãšè©¦ã—ãŸã„(è©•ä¾¡ã¯å¾Œå›ã—)'] },
      { id:'q10', axis:'I', title:'æ¥­å‹™åŠ¹ç‡åŒ–(æ™‚é–“å‰Šæ¸›)ã®ä¾¡å€¤æ›ç®—ã¯?', options:['äººä»¶è²»ãƒ»ç¨¼åƒãƒ»ä»£æ›¿ã‚³ã‚¹ãƒˆç­‰ã§å®šé‡åŒ–ã§ãã‚‹','ãŠãŠã‚ˆãã®äººä»¶è²»ãƒ™ãƒ¼ã‚¹ã§è¨ˆç®—ã§ãã‚‹','é‡‘é¡æ›ç®—ã¯ã—ã¦ã„ãªã„','è€ƒãˆãŸã“ã¨ãŒãªã„'] },
      { id:'q11', axis:'I', title:'AIå°å…¥ã®æˆåŠŸåŸºæº–(KPI)ã¯?', options:['å£²ä¸Š/ç²—åˆ©/å·¥æ•°/å“è³ªãªã©å…·ä½“KPIãŒã‚ã‚‹','å®šæ€§çš„ãªç›®æ¨™(ä¾‹:å±äººåŒ–è§£æ¶ˆ)ã¯ã‚ã‚‹','å°å…¥ã™ã‚‹ã“ã¨è‡ªä½“ãŒç›®æ¨™ã«ãªã‚ŠãŒã¡','ã¾ã æ±ºã‚ã¦ã„ãªã„'] },
      { id:'q12', axis:'I', title:'æŠ•è³‡å›åæœŸé–“ã®è€ƒãˆæ–¹ã¨ã—ã¦æœ€ã‚‚è¿‘ã„ã®ã¯?', options:['1å¹´ä»¥å†…ã«å›åã—ãŸã„(çŸ­æœŸã§æ¤œè¨¼â†’æ‹¡å¤§)','2ã€œ3å¹´ã§å›åã§ãã‚Œã°ã‚ˆã„','3å¹´ä»¥ä¸Šã§ã‚‚æ§‹ã‚ãªã„(é•·æœŸæŠ•è³‡å‰æ)','ç‰¹ã«è€ƒãˆã¦ã„ãªã„'] },
      { id:'q13', axis:'M', title:'åŒæ¥­ä»–ç¤¾ã®AIæ´»ç”¨çŠ¶æ³ã«ã¤ã„ã¦', options:['ä¸»è¦ä¼æ¥­ã®å–ã‚Šçµ„ã¿ã‚’æŠŠæ¡ã—ã€æ¯”è¼ƒãƒ»ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã—ã¦ã„ã‚‹','ã‚ã‚‹ç¨‹åº¦ã¯çŸ¥ã£ã¦ã„ã‚‹','æƒ…å ±ãŒå°‘ãªãã€æŠŠæ¡ã§ãã¦ã„ãªã„','ã»ã¼æŠŠæ¡ã—ã¦ã„ãªã„'] },
      { id:'q14', axis:'M', title:'AIæœªå°å…¥ã«ã‚ˆã‚‹äº‹æ¥­ãƒªã‚¹ã‚¯ã®èªè­˜ã¯?', options:['2ã€œ3å¹´ã§ç«¶äº‰åŠ›å·®ãŒå‡ºã‚‹å±æ©Ÿæ„ŸãŒã‚ã‚‹','ä¸­é•·æœŸçš„ã«ã¯å¿…è¦ã¨æ„Ÿã˜ã¦ã„ã‚‹','ä»Šã™ãå›°ã‚‹ã“ã¨ã¯ãªã„','ãƒªã‚¹ã‚¯ã¯æ„Ÿã˜ã¦ã„ãªã„'] },
      { id:'q15', axis:'M', title:'æ¥­ç•Œã®AIæ´»ç”¨ãƒˆãƒ¬ãƒ³ãƒ‰ã®è¿½ã„æ–¹ã¯?', options:['ç¶™ç¶šçš„ã«æƒ…å ±åé›†ã—ã€çµŒå–¶ãƒ¬ãƒ™ãƒ«ã§è­°è«–ã—ã¦ã„ã‚‹','ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚„ã‚»ãƒŸãƒŠãƒ¼ã§è¦‹ã‹ã‘ã‚‹ç¨‹åº¦','ã‚ã¾ã‚Šé–¢å¿ƒãŒãªã„','è‡ªç¤¾ã«ã¯é–¢ä¿‚ãªã„ã¨æ€ã£ã¦ã„ã‚‹'] },
      { id:'q16', axis:'M', title:'é¡§å®¢(ã¾ãŸã¯å–å¼•å…ˆ)ã‹ã‚‰ã®AIé–¢é€£ã®è¦æœ›/æœŸå¾…ã¯?', options:['å…·ä½“çš„ãªè¦æœ›ãƒ»è¦ä»¶ãŒæ—¢ã«ã‚ã‚‹','ä»Šå¾Œå¢—ãˆã‚‹ã¨äºˆæƒ³ã—ã¦ã„ã‚‹','ã¾ã ç‰¹ã«è¦æœ›ã¯ãªã„','é–¢ä¿‚ãªã„é ˜åŸŸã ã¨æ€ã†'] },
    ];

    const AXIS_LABELS = { S:'AIæˆ¦ç•¥æˆç†Ÿåº¦(S)', O:'çµ„ç¹”å®Ÿè¡ŒåŠ›(O)', I:'æŠ•è³‡åˆ¤æ–­åŠ›(I)', M:'ç«¶åˆèªè­˜åº¦(M)' };

    const TYPE_DEFS = {
      S:{
        name:'ã‚ãªãŸã¯ã€Œæ§‹æƒ³æ•´ç†ãƒ•ã‚§ãƒ¼ã‚ºå‹ã€ã§ã™ï¼',
        oneLine:'çµŒå–¶ã¨ã—ã¦ã®ã€Œç›®çš„ãƒ»å„ªå…ˆé †ä½ã€ã‚’æ•´ãˆã‚‹ã¨ã€AIæŠ•è³‡ãŒé€²ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚',
        now:'AIã®é‡è¦æ€§ã¯èªè­˜ã•ã‚Œã¦ãŠã‚Šã€å€‹åˆ¥ã®æ¤œè¨ã‚„è©¦è¡Œã‚‚å§‹ã¾ã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ã€çµŒå–¶ã¨ã—ã¦ã€Œä½•ã®ãŸã‚ã«AIã‚’ä½¿ã†ã®ã‹ã€ã€Œã©ã“ã‹ã‚‰ç€æ‰‹ã™ã‚‹ã®ã‹ã€ãŒã¾ã ååˆ†ã«æ•´ç†ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚ã“ã‚Œã¯å¤šãã®ä¼æ¥­ãŒæœ€åˆã«ç›´é¢ã™ã‚‹è‡ªç„¶ãªãƒ•ã‚§ãƒ¼ã‚ºã§ã™ã€‚',
        risk:'éƒ¨é–€ã”ã¨ã«ãƒ†ãƒ¼ãƒãŒåˆ†æ•£ã—ã¦æŠ•è³‡åˆ¤æ–­ãŒé›£ã—ããªã£ãŸã‚Šã€æˆæœã‚’çµŒå–¶è¦–ç‚¹ã§èª¬æ˜ã§ããšé€”ä¸­ã§æ­¢ã¾ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚ã€ŒAIã¯ã‚„ã£ãŸãŒã€çµŒå–¶ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒè¦‹ãˆãªã„ã€çŠ¶æ…‹ã«ãªã‚ŠãŒã¡ã§ã™ã€‚',
        next:'ãƒ»çµŒå–¶KPIã¨AIæ´»ç”¨ãƒ†ãƒ¼ãƒã®ç´ã¥ã‘\nãƒ»ç€æ‰‹ã™ã¹ãæ¥­å‹™ã®å„ªå…ˆé †ä½ä»˜ã‘\nãƒ»PoCã§çµ‚ã‚ã‚‰ã›ãªã„ãŸã‚ã®åˆ¤æ–­åŸºæº–'
      },
      O:{
        name:'ã‚ãªãŸã¯ã€Œå®Ÿè¡ŒåŸºç›¤æ§‹ç¯‰ãƒ•ã‚§ãƒ¼ã‚ºå‹ã€ã§ã™ï¼',
        oneLine:'äººæãƒ»ä½“åˆ¶ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ»æ„æ€æ±ºå®šãªã©ã€Œå›ã™åœŸå°ã€ã‚’å›ºã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚',
        now:'AIæ´»ç”¨ã®æ–¹å‘æ€§ã‚„ãƒ†ãƒ¼ãƒã¯è¦‹ãˆå§‹ã‚ã¦ã„ã¾ã™ãŒã€äººæãƒ»ä½“åˆ¶ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ»æ„æ€æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹ã¨ã„ã£ãŸã€Œå®Ÿè¡Œã®åœŸå°ã€ãŒã¾ã ååˆ†ã«æ•´ã£ã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚æˆ¦ç•¥ãŒã‚ã£ã¦ã‚‚å›ã‚‰ãªã„ã¨æˆæœã¯å‡ºã¾ã›ã‚“ã€‚',
        risk:'ä¸€éƒ¨ã®æ‹…å½“è€…ã«è² è·ãŒé›†ä¸­ã—ãŸã‚Šã€ç¾å ´ã«æµ¸é€ã›ãšä½¿ã‚ã‚Œãªã„ãƒ„ãƒ¼ãƒ«ãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ‹¡å¤§ãƒ•ã‚§ãƒ¼ã‚ºã«å…¥ã‚ŒãšåŠ¹æœãŒé™å®šçš„ã«ãªã‚Šã‚„ã™ã„ã§ã™ã€‚',
        next:'ãƒ»æ¨é€²è²¬ä»»è€…ãƒ»æ„æ€æ±ºå®šãƒ©ã‚¤ãƒ³ã®æ˜ç¢ºåŒ–\nãƒ»å†…è£½/å¤–æ³¨ã®åˆ‡ã‚Šåˆ†ã‘\nãƒ»ç¾å ´å±•é–‹ãƒ»æ•™è‚²ã®é€²ã‚æ–¹'
      },
      I:{
        name:'ã‚ãªãŸã¯ã€ŒæŠ•è³‡è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºå‹ã€ã§ã™ï¼',
        oneLine:'ROI/KPI/å›åã®ã€Œåˆ¤æ–­è»¸ã€ã‚’æ•´ãˆã‚‹ã¨ã€æ„æ€æ±ºå®šãŒä¸€æ°—ã«å‰é€²ã—ã¾ã™ã€‚',
        now:'AIæ´»ç”¨ã¸ã®é–¢å¿ƒã‚„å–ã‚Šçµ„ã¿æ„æ¬²ã¯é«˜ã„ä¸€æ–¹ã§ã€ROIãƒ»KPIãƒ»æŠ•è³‡å›åã®è€ƒãˆæ–¹ãŒã¾ã ååˆ†ã«è¨€èªåŒ–ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚ã“ã‚Œã¯ã€Œã‚„ã‚‹æ°—ã¯ã‚ã‚‹ãŒã€åˆ¤æ–­è»¸ãŒè¶³ã‚Šãªã„ã€ãƒ•ã‚§ãƒ¼ã‚ºã¨è¨€ãˆã¾ã™ã€‚',
        risk:'æŠ•è³‡åˆ¤æ–­ãŒæ„Ÿè¦šçš„ã«ãªã‚Šèª¬æ˜è²¬ä»»ã‚’æœãŸã—ã«ãããªã‚Šã¾ã™ã€‚æˆæœãŒå‡ºã¦ã„ã¦ã‚‚ã€ŒæˆåŠŸã€ã¨è¨€ã„åˆ‡ã‚Œãšã€è¿½åŠ æŠ•è³‡ã‚„æ‹¡å¤§åˆ¤æ–­ãŒé…ã‚Œã‚„ã™ããªã‚Šã¾ã™ã€‚',
        next:'ãƒ»æ¥­å‹™åŠ¹ç‡åŒ–ã®é‡‘é¡æ›ç®—æ–¹æ³•\nãƒ»æˆåŠŸãƒ»å¤±æ•—ã‚’åˆ†ã‘ã‚‹KPIè¨­è¨ˆ\nãƒ»PoCâ†’æœ¬æ ¼å±•é–‹ã®åˆ¤æ–­åŸºæº–'
      },
      M:{
        name:'ã‚ãªãŸã¯ã€Œç«¶äº‰å„ªä½æ¢ç´¢ãƒ•ã‚§ãƒ¼ã‚ºå‹ã€ã§ã™ï¼',
        oneLine:'å¤–éƒ¨è¦–ç‚¹(æ¥­ç•Œãƒ»ç«¶åˆãƒ»é¡§å®¢)ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã¨ã€AIæ´»ç”¨ã®æ‰“ã¡æ‰‹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚',
        now:'ç¤¾å†…æ”¹å–„ã‚„åŠ¹ç‡åŒ–ã®è¦–ç‚¹ã§ã¯AIã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ãŒã€æ¥­ç•Œå…¨ä½“ãƒ»ç«¶åˆãƒ»é¡§å®¢è¦–ç‚¹ã§ã®AIæ´»ç”¨ãŒã¾ã ååˆ†ã«æ•´ç†ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚å†…å‘ãã‹ã‚‰å¤–å‘ãã¸è¦–ç‚¹ã‚’åºƒã’ã‚‹æ®µéšã§ã™ã€‚',
        risk:'ç«¶åˆãŒå…ˆã«ä¾¡å€¤æä¾›ã‚’é«˜åº¦åŒ–ã—ãŸã‚Šã€é¡§å®¢æœŸå¾…ã®å¤‰åŒ–ã«å¾Œè¿½ã„ã«ãªã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚ã€Œæ°—ã¥ã„ãŸæ™‚ã«ã¯å·®ãŒã¤ã„ã¦ã„ã‚‹ã€çŠ¶æ…‹ã«ãªã‚ŠãŒã¡ã§ã™ã€‚',
        next:'ãƒ»åŒæ¥­ä»–ç¤¾ã®AIæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³æ•´ç†\nãƒ»è‡ªç¤¾ãŒå–ã‚‹ã¹ãå·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ\nãƒ»é¡§å®¢ä¾¡å€¤ã«ç›´çµã™ã‚‹AIãƒ†ãƒ¼ãƒã®ç‰¹å®š'
      },
    };

    const TIE_BREAK = ['S','I','O','M'];

    const KEY_ANS  = 'ai_diag_answers_v4';
    const KEY_STEP = 'ai_diag_step_v4';
    const KEY_DONE = 'ai_diag_done_v4';
    const KEY_LEAD = 'ai_diag_lead_v4';

    const pointsFromChoice = (l)=>({A:3,B:2,C:1,D:0})[l] ?? 0;
    const levelFromTotal   = (t)=> t<=15?'Lv1': t<=27?'Lv2': t<=39?'Lv3':'Lv4';
    const axisName         = (a)=>AXIS_LABELS[a] || a;

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    function getAllAnswers(){
      try{ return JSON.parse(lsGet(KEY_ANS) || '{}'); }catch(e){ return {}; }
    }
    function getAnswer(qid){ return getAllAnswers()[qid] || ''; }
    function setAnswer(qid,val){ const all=getAllAnswers(); all[qid]=val; lsSet(KEY_ANS, JSON.stringify(all)); }
    function clearAnswers(){ lsRemove(KEY_ANS); }

    function getStep(){
      const s = Number(lsGet(KEY_STEP) || '0');
      return Number.isFinite(s) ? Math.max(0, Math.min(QUESTIONS.length-1, s)) : 0;
    }
    function setStep(i){ lsSet(KEY_STEP, String(i)); }

    function getDone(){ return lsGet(KEY_DONE) === '1'; }
    function setDone(v){ lsSet(KEY_DONE, v ? '1' : '0'); }

    function getLead(){
      try{ return JSON.parse(lsGet(KEY_LEAD) || 'null'); }catch(e){ return null; }
    }
    function setLead(lead){ lsSet(KEY_LEAD, JSON.stringify(lead)); }
    function clearLead(){ lsRemove(KEY_LEAD); }

    function computeScores(){
      const scores={S:0,O:0,I:0,M:0};
      let total=0;
      for(const q of QUESTIONS){
        const p = pointsFromChoice(getAnswer(q.id));
        scores[q.axis]+=p;
        total+=p;
      }
      return {scores,total};
    }

    function determineType(scores){
      const entries = Object.entries(scores);
      const minVal  = Math.min(...entries.map(e=>e[1]));
      const mins    = entries.filter(e=>e[1]===minVal).map(e=>e[0]);
      if(mins.length===1) return mins[0];
      for(const a of TIE_BREAK){ if(mins.includes(a)) return a; }
      return mins[0];
    }

    function determineStrong(scores){
      const entries = Object.entries(scores);
      const maxVal  = Math.max(...entries.map(e=>e[1]));
      const maxes   = entries.filter(e=>e[1]===maxVal).map(e=>e[0]);
      const order   = ['S','I','O','M'];
      for(const a of order){ if(maxes.includes(a)) return a; }
      return maxes[0];
    }

    function ctaByLevel(level){
      const isLow = (level==='Lv1' || level==='Lv2');
      if(isLow) return {title:'æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:30åˆ†ã®ç„¡æ–™å£æ‰“ã¡(æ•´ç†ãƒã‚¤ãƒ³ãƒˆã®æ˜ç¢ºåŒ–)', desc:'è¨ºæ–­çµæœã‚’ã‚‚ã¨ã«ã€çµŒå–¶KPIãƒ»å„ªå…ˆé †ä½ãƒ»ä½“åˆ¶ãƒ»ROIã®ã©ã“ã‹ã‚‰æ•´ãˆã‚‹ã¹ãã‹ã‚’çŸ­æ™‚é–“ã§æ•´ç†ã—ã¾ã™ã€‚'};
      return {title:'æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:30åˆ†ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼(å„ªå…ˆé †ä½ãƒ»ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ãƒ»ROIè¨­è¨ˆ)', desc:'ã„ã¾ã®å–ã‚Šçµ„ã¿ã‚’å‰é€²ã•ã›ã‚‹ãŸã‚ã«ã€ãƒ†ãƒ¼ãƒé¸å®šãƒ»è©•ä¾¡è¨­è¨ˆãƒ»å±•é–‹ã®è«–ç‚¹ã‚’ä¸€ç·’ã«æ£šå¸ã—ã—ã¾ã™ã€‚'};
    }

    const elQuestionCard = document.getElementById('questionCard');
    const elProgressText = document.getElementById('progressText');
    const elProgressBar  = document.getElementById('progressBar');
    const elAxisPill     = document.getElementById('axisPill');
    const elToast        = document.getElementById('toast');
    const navHint        = document.getElementById('navHint');

    const btnPrev       = document.getElementById('btnPrev');
    const btnNext       = document.getElementById('btnNext');
    const btnReset      = document.getElementById('btnReset');
    const btnJumpResult = document.getElementById('btnJumpResult');

    const completeBox   = document.getElementById('completeBox');
    const btnToResult   = document.getElementById('btnToResult');
    const btnReview     = document.getElementById('btnReview');

    const leadModal      = document.getElementById('leadModal');
    const btnCloseModal  = document.getElementById('btnCloseModal');
    const btnSubmitLead  = document.getElementById('btnSubmitLead');
    const leadToast      = document.getElementById('leadToast');
    const inName         = document.getElementById('name');
    const inCompany      = document.getElementById('company');
    const inRole         = document.getElementById('role');
    const inEmail        = document.getElementById('email');

    const resultCard     = document.getElementById('resultCard');
    const resultMeta     = document.getElementById('resultMeta');
    const resultType     = document.getElementById('resultType');
    const resultOneLine  = document.getElementById('resultOneLine');
    const resultLevel    = document.getElementById('resultLevel');
    const resultTotal    = document.getElementById('resultTotal');

    const scoreS = document.getElementById('scoreS');
    const scoreO = document.getElementById('scoreO');
    const scoreI = document.getElementById('scoreI');
    const scoreM = document.getElementById('scoreM');

    const barS = document.getElementById('barS');
    const barO = document.getElementById('barO');
    const barI = document.getElementById('barI');
    const barM = document.getElementById('barM');

    const insightWeak   = document.getElementById('insightWeak');
    const insightStrong = document.getElementById('insightStrong');

    const txtNow  = document.getElementById('txtNow');
    const txtRisk = document.getElementById('txtRisk');
    const txtNext = document.getElementById('txtNext');

    const ctaTitle = document.getElementById('ctaTitle');
    const ctaDesc  = document.getElementById('ctaDesc');

    function allAnswered(){ return QUESTIONS.every(q=>!!getAnswer(q.id)); }

    function syncCompletionUI(){
      const canShow = getDone() && allAnswered();
      btnJumpResult.disabled = !canShow;
      btnJumpResult.style.opacity = canShow ? 1 : .55;
      completeBox.style.display = canShow ? 'block' : 'none';
      if(!canShow) resultCard.style.display='none';
    }

    function showToast(msg){
      elToast.style.display='block';
      elToast.textContent=msg;
    }

    function renderStep(){
      const i = getStep();
      const q = QUESTIONS[i];
      const n = i + 1;
      const saved = getAnswer(q.id);

      elProgressText.textContent = `${n} / ${QUESTIONS.length}`;
      elProgressBar.style.width  = `${Math.round((n/QUESTIONS.length)*100)}%`;
      elAxisPill.textContent     = axisName(q.axis);

      btnPrev.disabled = (i===0);
      btnPrev.style.opacity = btnPrev.disabled ? .55 : 1;

      const isLast = (i===QUESTIONS.length-1);
      btnNext.textContent = isLast ? 'å®Œäº†ã™ã‚‹ âœ“' : 'æ¬¡ã¸ â†’';
      navHint.textContent = saved ? 'OK!ã“ã®ã¾ã¾é€²ã‚ã¾ã™' : 'é¸æŠã—ã¦ã€Œæ¬¡ã¸ã€';

      elQuestionCard.innerHTML = `
        <div class="qhead">
          <div>
            <div class="qno"><span class="dot"></span> Q${n}</div>
            <div class="qtext">${escapeHtml(q.title)}</div>
          </div>
          <div class="axis">${escapeHtml(axisName(q.axis))}</div>
        </div>
        <div class="opts">
          ${['A','B','C','D'].map((letter, idx)=>{
            const optId = `${q.id}_${letter}`;
            const checked = (saved===letter) ? 'checked' : '';
            return `
              <label class="opt" for="${optId}">
                <input type="radio" name="${q.id}" id="${optId}" value="${letter}" ${checked} />
                <div class="otext"><b>${letter})</b> ${escapeHtml(q.options[idx])}</div>
              </label>
            `;
          }).join('')}
        </div>
      `;

      // â˜…ä¿®æ­£: inputã®`change`ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ã‚’ä½¿ç”¨
      elQuestionCard.querySelectorAll('input[type=radio]').forEach((input)=>{
        input.addEventListener('change', (e)=>{
          if(e.target.checked){
            setAnswer(q.id, e.target.value);
            navHint.textContent='OK!ã“ã®ã¾ã¾é€²ã‚ã¾ã™';
            elToast.style.display='none';
          }
        });
      });

      syncCompletionUI();
    }

    function next(){
      const i = getStep();
      const q = QUESTIONS[i];
      
      // â˜…ä¿®æ­£: ç¾åœ¨ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‹ã‚‰å€¤ã‚’å–å¾—
      const picked = elQuestionCard.querySelector(`input[name="${q.id}"]:checked`);
      if(picked && picked.value){ 
        setAnswer(q.id, picked.value); 
      }

      if(!getAnswer(q.id)){
        showToast('ã“ã®è³ªå•ã®å›ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      elToast.style.display='none';

      if(i === QUESTIONS.length - 1){
        setDone(true);
        syncCompletionUI();
        completeBox.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      setStep(i+1);
      renderStep();
    }

    function prev(){
      const i = getStep();
      if(i===0) return;
      setStep(i-1);
      renderStep();
    }

    function validEmail(email){
      const at = email.indexOf('@');
      if(at <= 0) return false;
      const domain = email.slice(at+1);
      return domain.includes('.') && domain.length >= 3;
    }

    function openLeadModal(){
      const lead = getLead();
      if(lead){
        inName.value    = lead.name || '';
        inCompany.value = lead.company || '';
        inRole.value    = lead.role || '';
        inEmail.value   = lead.email || '';
      }
      leadToast.style.display='none';
      leadModal.showModal();
    }
    function closeLeadModal(){ leadModal.close(); }

    function submitLead(){
      const name    = inName.value.trim();
      const company = inCompany.value.trim();
      const role    = inRole.value.trim();
      const email   = inEmail.value.trim();

      const errors=[];
      if(!name) errors.push('æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if(!company) errors.push('ä¼šç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if(!role) errors.push('å½¹è·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if(!email) errors.push('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      else if(!validEmail(email)) errors.push('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');

      if(errors.length){
        leadToast.style.display='block';
        leadToast.textContent = errors.join(' / ');
        return;
      }

      setLead({name, company, role, email, savedAt: new Date().toISOString()});
      closeLeadModal();
      showResult();
    }

    function showResult(){
      const {scores,total} = computeScores();
      const level = levelFromTotal(total);
      const weakAxis = determineType(scores);
      const strongAxis = determineStrong(scores);
      const def = TYPE_DEFS[weakAxis];
      const lead = getLead();

      resultMeta.textContent = lead ? `${lead.company} / ${lead.role} / ${lead.name}` : 'â€”';
      resultType.textContent = def.name;
      resultOneLine.textContent = def.oneLine;
      resultLevel.textContent = level;
      resultTotal.textContent = `Total ${total}/48`;

      const pct = (v)=>Math.round((v/12)*100);
      scoreS.textContent = `${scores.S}/12`; barS.style.width = `${pct(scores.S)}%`;
      scoreO.textContent = `${scores.O}/12`; barO.style.width = `${pct(scores.O)}%`;
      scoreI.textContent = `${scores.I}/12`; barI.style.width = `${pct(scores.I)}%`;
      scoreM.textContent = `${scores.M}/12`; barM.style.width = `${pct(scores.M)}%`;

      insightWeak.textContent   = `${axisName(weakAxis)}(æœ€å„ªå…ˆã§æ•´ãˆã‚‹ã¨å‰é€²ã—ã‚„ã™ã„)`;
      insightStrong.textContent = `${axisName(strongAxis)}(ä»Šã®å¼·ã¿ã¨ã—ã¦æ´»ã‹ã—ã‚„ã™ã„)`;

      txtNow.textContent  = def.now;
      txtRisk.textContent = def.risk;
      txtNext.textContent = def.next;

      const cta = ctaByLevel(level);
      ctaTitle.textContent = cta.title;
      ctaDesc.textContent  = cta.desc;

      resultCard.style.display='block';
      resultCard.scrollIntoView({behavior:'smooth', block:'start'});
    }

    function goToResultFlow(){
      if(!(getDone() && allAnswered())) return;
      const lead = getLead();
      if(lead && lead.name && lead.company && lead.role && lead.email) showResult();
      else openLeadModal();
    }

    btnPrev.addEventListener('click', prev);
    btnNext.addEventListener('click', next);
    btnJumpResult.addEventListener('click', goToResultFlow);
    btnToResult.addEventListener('click', goToResultFlow);

    btnReview.addEventListener('click', ()=>{ setStep(0); renderStep(); window.scrollTo({top:0, behavior:'smooth'}); });

    btnReset.addEventListener('click', ()=>{
      if(confirm('å›ç­”ã¨å…¥åŠ›æƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?(ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤)')){
        clearAnswers();
        clearLead();
        lsRemove(KEY_STEP);
        setDone(false);
        setStep(0);
        renderStep();
        syncCompletionUI();
        window.scrollTo({top:0, behavior:'smooth'});
      }
    });

    btnCloseModal.addEventListener('click', closeLeadModal);
    btnSubmitLead.addEventListener('click', submitLead);

    document.getElementById('btnCta').addEventListener('click', ()=>{
      alert('(ãƒ‡ãƒ¢)ã“ã“ã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ /æ—¥ç¨‹èª¿æ•´URLã¸é·ç§»ã•ã›ã¦ãã ã•ã„ã€‚');
    });

    if(!allAnswered()) setDone(false);
    renderStep();
    syncCompletionUI();
  </script>
</body>
</html>
